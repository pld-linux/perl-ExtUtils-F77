--- ExtUtils-F77-1.16/F77.pm.orig	2007-04-02 06:40:23.000000000 +0200
+++ ExtUtils-F77-1.16/F77.pm	2008-03-28 10:20:31.965651075 +0100
@@ -173,19 +173,23 @@
     my @libs = ('g2c', 'f2c');
     my ($dir, $lib, $test);
     foreach $test (@libs) {
-      $dir = `g77 -print-file-name=lib$test.a`;
+      foreach $ext ('.so', '.a') {
+      $dir = `g77 -print-file-name=lib$test$ext`;
       chomp $dir;
       # Note that -print-file-name returns just the library name
       # if it cant be found - make sure that we only accept the
       # directory if it returns a proper path (or matches a /)
-      if (defined $dir && $dir ne "lib$test.a") {
+      if (defined $dir && $dir ne "lib$test$ext") {
         $lib = $test; # Found an existing library
         last; 
       }
+      }
+      last if (defined $lib);
     }
 
     if( defined $dir  && defined $lib) {
-        $dir =~ s,/lib$lib.a$,,;
+        $dir =~ s,/lib$lib\..*$,,;
+	$dir = `cd $dir ; pwd`; # sanitize
     } else {
         $dir = "/usr/local/lib";
         $lib = "f2c";
@@ -194,7 +199,7 @@
 };
 $F77config{Generic}{G77}{Trail_} = 1;
 $F77config{Generic}{G77}{Compiler} = find_in_path('g77','f77','fort77');
-$F77config{Generic}{G77}{Cflags} = '-O';
+$F77config{Generic}{G77}{Cflags} = "$Config{'optimize'}";
 $F77config{Generic}{DEFAULT} = 'G77';
 $F77config{Generic}{F2c}     = $F77config{Generic}{G77};
 
